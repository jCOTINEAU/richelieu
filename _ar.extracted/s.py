from math import sqrt; from itertools import count, islice
import random
import gmpy2
from gmpy2 import mpz,c_div,mul,c_divmod,c_mod




n = mpz(837849563862443268467145186974119695264713699736869090645354954749227901572347301978135797019317859500555501198030540582269024532041297110543579716921121054608494680063992435808708593796476251796064060074170458193997424535149535571009862661106986816844991748325991752241516736019840401840150280563780565210071876568736454876944081872530701199426927496904961840225828224638335830986649773182889291953429581550269688392460126500500241969200245489815778699333733762961281550873031692933566002822719129034336264975002130651771127313980758562909726233111335221426610990708111420561543408517386750898610535272480495075060087676747037430993946235792405851007090987857400336566798760095401096997696558611588264303087788673650321049503980655866936279251406742641888332665054505305697841899685165810087938256696223326430000379461379116517951965921710056451210314300437093481577578273495492184643002539393573651797054497188546381723478952017972346925020598375000908655964982541016719356586602781209943943317644547996232516630476025321795055805235006790200867328602560320883328523659710885314500874028671969578391146701739515500370268679301080577468316159102141953941314919039404470348112690214065442074200255579004452618002777227561755664967507)

f = open("../myI1", "r")
c = f.read()
p = mpz (c)


e = 65537
#temp exec
#p =17
#n = 187
#e = 7


##trasnvrt 


q = c_div(n,p)

#p2=p
#q2=q

#p=q2
#q=p2


print(q)
print("------\n")


phi = (p-1)*(q-1)

m = phi

d = gmpy2.invert(e,m)
print(d)

e1 = d % (p-1)
e2 = d %(q-1)
coef = gmpy2.invert(q,p)

print("e1 : "+str(e1))

print("e2 : "+str(e2))

print("coef"+str(coef))


mP="asn1=SEQUENCE:rsa_key\n"
mP=mP+"\n"
mP=mP+"[rsa_key]\n"
mP=mP+"version=INTEGER:0\n"
mP=mP+"modulus=INTEGER:"+str(n)+"\n"
mP=mP+"pubExp=INTEGER:"+str(e)+"\n"
mP=mP+"privExp=INTEGER:"+str(d)+"\n"
mP=mP+"p=INTEGER:"+str(p)+"\n"
mP=mP+"q=INTEGER:"+str(q)+"\n"
mP=mP+"e1=INTEGER:"+str(e1)+"\n"
mP=mP+"e2=INTEGER:"+str(e2)+"\n"
mP=mP+"coeff=INTEGER:"+str(coef)+"\n"

print(mP)

f = open ("privkey.asn","w")
f.write(mP)
